$(document).ready(function(){var f=function(s){var t;if(typeof(s)==="number"){t=s}var u;$.ajax({async:false,type:"get",dataType:"json",url:"/registration/activityinfo?activityId="+t.toString(),success:function(v){if(u===undefined){u=v}},error:function(){alert("当前网络不佳，暂时无法进行报名活动")}});return u};var n=function(u){var B=u;var H=document.createElement("div");H.setAttribute("id","question"+B.question_id.toString());var v=document.createElement("div");v.setAttribute("id","type"+B.question_id.toString());var A=document.createElement("p");A.setAttribute("id","intro"+B.question_id.toString());var x;var C=document.createElement("div");C.setAttribute("id","content"+B.question_id.toString());var E;switch(B.type){case 1:E=document.createElement("input");E.setAttribute("type","text");x=document.createTextNode(B.label);break;case 2:E=document.createElement("textarea");E.setAttribute("rows","6");E.setAttribute("style","resize:none");x=document.createTextNode(B.label);break;case 3:E=document.createElement("select");var F=B.content;for(var t in F){E.options.add(new Option(F[t].toString(),t.toString()))}x=document.createTextNode(B.label);break;case 101:E=document.createElement("input");E.setAttribute("type","number");E.setAttribute("placeholder","请输入您的学号");E.setAttribute("disabled",true);E.value=_stuId;x=document.createTextNode("学号");break;case 102:E=document.createElement("input");E.setAttribute("type","text");E.setAttribute("placeholder","请输入您的姓名");E.setAttribute("disabled",true);E.value=_stuName;x=document.createTextNode("姓名");break;case 103:E=document.createElement("select");E.options.add(new Option("男生♂","1"));E.options.add(new Option("女生♀","0"));x=document.createTextNode("性别");break;case 104:E=document.createElement("select");E.options.add(new Option("机械工程学院","机械工程学院"));E.options.add(new Option("电子信息学院","电子信息学院"));E.options.add(new Option("通信工程学院","通信工程学院"));E.options.add(new Option("自动化学院","自动化学院"));E.options.add(new Option("计算机学院","计算机学院"));E.options.add(new Option("生命信息与仪器工程学院","生命信息与仪器工程学院"));E.options.add(new Option("材料与环境工程学院","材料与环境工程学院"));E.options.add(new Option("软件工程学院","软件工程学院"));E.options.add(new Option("理学院","理学院"));E.options.add(new Option("经济学院","经济学院"));E.options.add(new Option("管理学院","管理学院"));E.options.add(new Option("会计学院","会计学院"));E.options.add(new Option("外国语学院","外国语学院"));E.options.add(new Option("数字媒体与艺术设计学院","数字媒体与艺术设计学院"));E.options.add(new Option("人文与法学院","人文与法学院"));E.options.add(new Option("马克思主义学院","马克思主义学院"));E.options.add(new Option("卓越学院","卓越学院"));E.options.add(new Option("信息工程学院","信息工程学院"));E.options.add(new Option("国际教育学院","国际教育学院"));E.options.add(new Option("继续教育学院","继续教育学院"));x=document.createTextNode("学院");break;case 105:E=document.createElement("input");E.setAttribute("type","text");E.setAttribute("placeholder","请输入您的专业");x=document.createTextNode("专业");break;case 106:E=document.createElement("textarea");E.setAttribute("placeholder","请说说您的特长");E.setAttribute("rows","6");E.setAttribute("style","resize:none");x=document.createTextNode("特长");break;case 107:E=document.createElement("input");E.setAttribute("type","email");E.setAttribute("placeholder","其输入您的电子邮箱地址");x=document.createTextNode("电子邮箱");break;case 108:E=document.createElement("input");E.setAttribute("type","number");E.setAttribute("placeholder","请输入您的QQ号码");x=document.createTextNode("QQ");break;case 109:E=document.createElement("input");E.setAttribute("type","number");E.setAttribute("placeholder","请输入您的手机长号");x=document.createTextNode("手机长号");break;case 110:E=document.createElement("input");E.setAttribute("type","number");E.setAttribute("placeholder","请输入您的移动短号");x=document.createTextNode("移动短号");break;case 111:E=document.createElement("input");E.setAttribute("type","text");E.setAttribute("placeholder","请填写您的籍贯");x=document.createTextNode("籍贯");break;case 112:E=document.createElement("select");var s=JSON.parse(B.content);for(var z=0;z<s.length;z++){E.options.add(new Option(s[z],s[z]))}x=document.createTextNode("第一志愿部门");break;case 113:E=document.createElement("select");var G=JSON.parse(B.content);for(var y=0;y<G.length;y++){E.options.add(new Option(G[y],G[y]))}x=document.createTextNode("第二志愿部门");break;case 114:E=document.createElement("select");var D=JSON.parse(B.content);for(var w=0;w<D.length;w++){E.options.add(new Option(D[w],D[w]))}x=document.createTextNode("第三志愿部门");break;case 115:E=document.createElement("select");E.options.add(new Option("是","是"));E.options.add(new Option("否","否"));x=document.createTextNode("是否服从调剂");break;default:E=document.createElement("div");x=document.createTextNode("");break}E.setAttribute("id","answer"+B.question_id.toString());A.appendChild(x);v.appendChild(A);H.appendChild(v);C.appendChild(E);H.appendChild(C);document.getElementById("regform").appendChild(H)};var h=function(u){var s=u;for(var t in s.questions){n(s.questions[t])}document.title=s.name};var i=_activityId;var j;if(typeof(i)==="number"){j=f(i)}h(j);function o(){var s=navigator.userAgent.toLowerCase();if(s.match(/MicroMessenger/i)=="micromessenger"){return true}else{return false}}if(o()){$("#logout").remove()}var k;$.ajax({async:false,type:"get",dataType:"json",url:"/organization/org-info?activityId="+_activityId,success:function(s){if(k===undefined){k=s}},error:function(){alert("当前网络不佳，暂时无法获取社团信息")}});var g=document.createTextNode(" "+j.name);var r=document.createElement("img");r.setAttribute("id","titlelogo");r.setAttribute("class","img-rounded");r.setAttribute("src",k.logo_url);r.setAttribute("alt",j.name);if(j.theme===1){document.getElementById("titlearea").insertBefore(r,document.getElementById("title"))}else{document.getElementById("title").appendChild(r)}document.getElementById("title").appendChild(g);$("#orginfo").prop("href","/shetuan/"+k.org_id);var l=new Date();var m=j.start_time.split(/[\s:-]/);var b=j.stop_time.split(/[\s:-]/);var d=new Date(parseInt(m[0]),parseInt(m[1])-1,parseInt(m[2]),parseInt(m[3]),parseInt(m[4]),0);var p=new Date(parseInt(b[0]),parseInt(b[1])-1,parseInt(b[2]),parseInt(b[3]),parseInt(b[4]),0);$("#timeinfo")[0].textContent="报名时间： "+m[1]+"月"+m[2]+"日 "+m[3]+":"+m[4]+" ~ "+b[1]+"月"+b[2]+"日 "+b[3]+":"+b[4];if(l>p){$("div").prop("disabled",true);$("input").prop("disabled",true);$("textarea").prop("disabled",true);$("select").prop("disabled",true);$("#submit").prop("disabled",true);alert("对不起，亲，你来晚了哟(T_T)")}else{if(l<d){$("div").prop("disabled",true);$("input").prop("disabled",true);$("textarea").prop("disabled",true);$("select").prop("disabled",true);$("#submit").prop("disabled",true);alert("客官稍安勿躁，还没开始报名~")}}var a=function(z,u){var x=z;var y=parseInt(u);var s=new RegExp("^..");var w=parseInt(s.exec(x));var t=x.length===9&&parseInt(y/10000)===1;var v=x.length===8&&parseInt(y%parseInt(Math.pow(10,15-w))/parseInt(Math.pow(10,14-w)))===1;return(t||v)};var q=function(x,u){var z,w;if(typeof(x)==="string"&&typeof(u)==="number"){z=x;w=u}else{return false}var s=new RegExp("^1[1-4][0-9]{6,7}$");var v=new RegExp("^((1[358][0-9])|(17[0678]))[0-9]{8}$");var A=new RegExp("^[0-9]{6,10}$");var y=new RegExp("^[a-zA-Z0-9][a-zA-Z0-9-._]*@.+.[a-zA-z]{2,4}$");var t=true;switch(w){case 101:t=s.test(z);break;case 107:t=y.test(z);break;case 108:t=A.test(z);break;case 109:t=v.test(z);break;default:break}return t};if(a(_stuId.toString(),j.limit_grade)){}else{$("div").prop("disabled",true);$("input").prop("disabled",true);$("textarea").prop("disabled",true);$("select").prop("disabled",true);$("#submit").prop("disabled",true);alert("不好意思哦，你不在社团规定的年级范围内。")}var c=0;function e(){c++}setInterval(e,1000);$("#submit").click(function(){var w={used_time:"",result:[]};var u=true;var t=c;w.used_time+=parseInt(t/3600).toString()+":";t=t%3600;w.used_time+=parseInt(t/60).toString()+":";w.used_time+=(t%60).toString();for(var v=1;v<=j.questions.length;v++){var s={question_id:"",answer:""};s.question_id=j.questions[v-1].question_id.toString();var y=document.getElementById("answer"+v.toString()).value;if(q(y,j.questions[v-1].type)){s.answer=y}else{alert("【"+j.questions[v-1].label+"】这一项你的输入有误哦！");u=false}w.result[v-1]=s}if(u){$("#submit").prop("disabled",true);var x={activityId:j.activityId,participatorInfo:JSON.stringify(w)};$.ajax({type:"POST",url:"/registration/participateinactivity",data:x,dataType:"json",success:function(z){if(z.status==="success"){alert(z.content);window.location.href="/baoming/success"}else{if(z.status==="fail"){alert(z.content);$("#submit").prop("disabled",false)}}},error:function(B,z,A){if(z==="timeout"){alert("连接超时，请检查网络");$("#submit").prop("disabled",false)}else{if(z==="error"||z==="parseerror"){alert("提交失败："+z+" "+A.toString());$("#submit").prop("disabled",false)}}}})}})});